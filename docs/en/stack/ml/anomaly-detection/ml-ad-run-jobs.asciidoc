
[[ml-ad-run-jobs]]
= Run {anomaly-jobs}
++++
<titleabbrev>Run a job</titleabbrev>
++++
:keywords: {ml-init}, {stack}, {anomaly-detect}

{anomaly-jobs-cap} contain the configuration information and metadata
necessary to perform the {ml} analysis. They can run for a specific time period
or continuously against incoming data.

[discrete]
[[ml-ad-setup]]
== Set up the environment

Before you can use the {stack-ml-features}, there are some configuration
requirements (such as security privileges) that must be addressed. Refer to
<<setup>>.

[NOTE]
===============================
If your data is located outside of {es}, you cannot use {kib} to create
your jobs and you cannot use {dfeeds} to retrieve your data in real time.
Posting data directly to {anomaly-jobs} is deprecated, in a future major version
a {dfeed} will be required.
===============================

[discrete]
[[ml-ad-create-job]]
== Create an {anomaly-job}

You can create {anomaly-jobs} by using the
{ref}/ml-put-job.html[create {anomaly-jobs} API]. {kib} also provides
wizards to simplify the process, which vary depending on whether you are using
the {ml-app} app, {security-app} or {observability} apps. To open *Anomaly Detection*, 
find *{ml-app}* in the main menu, or use the {kibana-ref}/kibana-concepts-analysts.html#_finding_your_apps_and_objects[global search bar].
In *{ml-app}* > *Anomaly Detection*:

[role="screenshot"]
image::images/ml-create-job.png[Create New Job]
// NOTE: This is an autogenerated screenshot. Do not edit it directly.

* The single metric wizard creates simple jobs that have a single detector. A
_detector_ applies an analytical function to specific fields in your data. In
addition to limiting the number of detectors, the single metric wizard omits
many of the more advanced configuration options.

* The multi-metric wizard creates jobs that can have more than one detector,
which is more efficient than running multiple jobs against the same data.

* The population wizard creates jobs that detect activity that is unusual compared
to the behavior of the population.

* The categorization wizard creates jobs that group log messages into categories
and use `count` or `rare` functions to detect anomalies within them.

* The advanced wizard creates jobs that can have multiple detectors and enables
you to configure all job settings.

//TBD The rare wizard creates jobs that use `rare` or `freq_rare` functions to detect

{kib} can also recognize certain types of data and provide specialized wizards
for that context. For example, there are {anomaly-jobs} for the sample
eCommerce orders and sample web logs data sets, as well as for data generated by
the {elastic-sec} and {observability} solutions, {beats}, and {agent}
{integrations}. For a list of all the preconfigured jobs, see <<ootb-ml-jobs>>.

[[ml-ad-job-tips]]
include::job-tips.asciidoc[]

////
You can optionally assign jobs to one or more _job groups_. You can use
job groups to view the results from multiple jobs more easily and to expedite
administrative tasks by opening or closing multiple jobs at once.
////

//TBD Mention impact of model plot config?

[discrete]
[[ml-ad-datafeeds]]
=== {dfeeds-cap}

include::ml-datafeeds.asciidoc[]

[discrete]
[[ml-ad-open-job]]
== Open the job

An {anomaly-job} must be opened in order for it to be ready to receive and
analyze data. It can be opened and closed multiple times throughout its
lifecycle.

After you start the job, you can start the {dfeed}, which retrieves data from
your cluster. A {dfeed} can be started and stopped multiple times throughout its
lifecycle. When you start it, you can optionally specify start and end times. If
you do not specify an end time, the {dfeed} runs continuously.

You can perform both these tasks in {kib} or use the
{ref}/ml-open-job.html[open {anomaly-jobs}] and
{ref}/ml-start-datafeed.html[start {dfeeds}] APIs.

[discrete]
[[ml-ad-tune]]
== Tune the job

Typically after you open a job, the next step is to
<<ml-ad-view-results,view the results>>. You might find that you need to alter
the job configuration or settings.

[discrete]
[[ml-ad-calendars]]
=== Calendars and scheduled events

include::ml-calendars.asciidoc[]

[discrete]
[[ml-ad-rules]]
=== Custom rules

include::ml-rules.asciidoc[]

[discrete]
[[ml-ad-model-snapshots]]
=== Model snapshots

include::ml-model-snapshots.asciidoc[]

[discrete]
[[ml-ad-close-job]]
== Close the job

When historical data is analyzed, there is no need to stop the {dfeed} and/or
close the job as they are stopped and closed automatically when the end time is
reached.

include::stopping-ml.asciidoc[leveloffset=+1]
