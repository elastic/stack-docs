[chapter,role="xpack"]
[[setup]]
= Set up {ml-features}
++++
<titleabbrev>Setup and security</titleabbrev>
++++

[discrete]
[[requirements-overview]]
== Requirements overview

The list below contains the requirements for enabling {ml-features}. Use the 
list as a quick reference to check if your setup meets the conditions. Refer to 
the <<ml-nodes>> and <<setup-privileges>> sections for details.

[%interactive]
* [ ] the {subscriptions}[appropriate subscription] level or the free trial 
  period activated
* [ ] `xpack.ml.enabled` set to its default value of `true` on every node in the 
  cluster
* [ ] `ml` value defined in the list of `node.roles` on the {ml} nodes
* [ ] {ml} features visible in the {kib} space
* [ ] `machine_learning_admin` or `machine_learning_user` built-in roles or equivalent custom roles for 
  users when {security-features} are enabled

TIP: The fastest way to get started with {ml-features} is to
{ess-trial}[start a free 14-day trial of {ess}] in the cloud.


[discrete]
[[ml-nodes]]
== Machine learning nodes

To use {ml-features}, there must be at least one {ml} node in your cluster. A
{ml} node is a node that has `xpack.ml.enabled` set to `true` and `ml` in
`node.roles`. For more information, see 
{ref}/modules-node.html#ml-node[{ml-cap} nodes] and 
{ref}/ml-settings.html[{ml-cap} settings in {es}].


[discrete]
[[setup-privileges]]
== Security privileges


[discrete]
[[es-security-privileges]]
=== {es} security privileges

If you use {ml} APIs and the {security-features} are enabled, you must have the 
`machine_learning_admin` or `machine_learning_user` built-in roles or the 
equivalent cluster privileges and the following index privileges:

For full access:

* [ ] `read` and `view_index_metadata` on source indices
* [ ] `read`, `manage`, and `index` on destination indices (for 
  {dfanalytics-jobs} only)

For read-only access:

* [ ] `read` index privileges on source indices
* [ ] `read` index privileges on destination indices (for {dfanalytics-jobs}
only)


[discrete]
[[kib-security-privileges]]
=== {kib} privileges

In {kib}, the {ml-features} must be visible in your
{kibana-ref}/xpack-spaces.html#spaces-control-feature-visibility[space] and your
source {data-sources} must exist in the same space as your {ml} jobs.

{kib} enables you to control access to the {ml-features} within each space. You 
can manage your roles, privileges, and spaces in the **{stack-manage-app}** app 
in {kib}. For more information, see 
{ref}/security-privileges.html[Security privileges] and 
{kibana-ref}/kibana-privileges.html[{kib} privileges].

[role="screenshot"]
image::spaces.jpg["Manage spaces in {kib}"]

The `machine_learning_admin` and `machine_learning_user` roles grant access to 
the {ml-features} in all spaces. Therefore, when you use {kib}, use custom roles 
instead and set your {kib} privileges appropriately for each space.

For full access to the {ml-features} in {kib}, you must have:

[%interactive]
* [ ] `all` {kib} privileges for the {ml-features} in the appropriate spaces
* [ ] `read` and `view_index_metadata` index privileges on source indices
* [ ] `read`, `manage`, and `index` index privileges on destination indices (for
  {dfanalytics-jobs} only)

For read-only access to the {ml-features} in {kib}, you must have:

[%interactive]
* [ ] `read` {kib} privileges for the {ml-features} in the appropriate spaces
* [ ] `read` index privileges on source indices
* [ ] `read` index privileges on destination indices (for {dfanalytics-jobs}
only)


[discrete]
[[upload-file-security-privileges]]
=== Security privileges for {data-viz}

To upload and import files in the *{data-viz}*, you must have:

[%interactive]
* [ ] `all` {kib} privileges for the {ml-app} or Discover features in
the appropriate spaces. Alternatively, `read` {kib} privileges for the {ml-app}
feature and `all` {kib} privileges for the {ipm-app} feature
* [ ] `manage_pipeline` or `manage_ingest_pipelines` cluster privileges
* [ ] `create`, `create_index`, `manage` and `read` index privileges for
destination indices