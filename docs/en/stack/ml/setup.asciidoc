[chapter,role="xpack"]
[[setup]]
= Set up {ml-features}
++++
<titleabbrev>Setup and security</titleabbrev>
++++

[discrete]
[[requirements-overview]]
== Requirements overview

To use the {stack} {ml-features}, you must have:

[%interactive]
- [ ] the {subscriptions}[appropriate subscription] level or the free trial 
  period activated
- [ ] `xpack.ml.enabled` set to its default value of `true` on every node in the 
  cluster (refer to {ref}/ml-settings.html[{ml-cap} settings in {es}])
- [ ] `ml` value defined in the list of `node.roles` on the 
  {ref}/modules-node.html#ml-node[{ml} nodes]
- [ ] {ml} features visible in the {kib} space
- [ ] security privileges assigned to the user. Either of the following options:
    * built-in roles: `machine_learning_admin` or `machine_learning_user`
    * {kib} feature privileges: `Machine Learning All` or `Read` 
    * equivalent custom roles.

TIP: The fastest way to get started with {ml-features} is to
{ess-trial}[start a free 14-day trial of {ess}] in the cloud.


[discrete]
[[setup-privileges]]
== Security privileges

Security privileges can be assigned as either {es} privileges or {kib} feature 
privileges. The user is granted the most permissive combination of both. You can 
configure these privileges under **{stack-manage-app}** > _Security_ in {kib} or 
via the respective {es} APIs. 

If you use {ml-features} via {es} APIs or _Dev Tools_ in {kib}, {es} security 
privileges are required. If you use {ml} only in {kib}, you may configure either 
{kib} feature privileges or {es} security privileges. If you contorol job level 
visibility via _Spaces_, then it's recommended to use {kib} feature privileges.


[discrete]
[[es-security-privileges]]
=== {es} security privileges

If you use {ml} APIs, you must have the `machine_learning_admin` or 
`machine_learning_user` built-in roles or the equivalent cluster privileges and 
the following index privileges:

For full access:

[%interactive]
* [ ] `read` and `view_index_metadata` on source indices
* [ ] `read`, `manage`, and `index` on destination indices (for 
  {dfanalytics-jobs} only)

For read-only access:

[%interactive]
* [ ] `read` index privileges on source indices
* [ ] `read` index privileges on destination indices (for {dfanalytics-jobs}
  only)


[discrete]
[[kib-security-privileges]]
=== {kib} privileges

In {kib}, the {ml-features} must be visible in your
{kibana-ref}/xpack-spaces.html#spaces-control-feature-visibility[space] and your
source {data-sources} must exist in the same space as your {ml} jobs.

{kib} enables you to control access to the {ml-features} within each space. You 
can manage your roles, privileges, and spaces in {kib}. For example, you can 
change which features are visible in a specific space in 
**{stack-manage-app}** > _Spaces_:

[role="screenshot"]
image::spaces.jpg["Manage spaces in {kib}"]

For more information, see {ref}/security-privileges.html[Security privileges] 
and {kibana-ref}/kibana-privileges.html[{kib} privileges].

Within a {kib} space, for full access to the {ml-features}, you must have:

[%interactive]
* [ ] `all` {kib} privileges for the {ml-features}
* [ ] {data-sources} for your source data
* [ ] `read`, `manage`, and `index` index privileges on destination indices (for 
  {dfanalytics-jobs} only)


Within a {kib} space, for read-only access to the {ml-features}, you must have:

[%interactive]
* [ ] `read` {kib} privileges for the {ml-features}
* [ ] {data-sources} for your source data
* [ ] {data-sources} on destination indices (for {dfanalytics-jobs} only)

For access to use {ml} APIs via _Dev Tools_ in {kib}, set the {es} security 
privileges and grant access to `machine_learning_admin` or 
`machine_learning_user` roles.


[discrete]
[[upload-file-security-privileges]]
=== Security privileges for {data-viz}

To upload and import files in the *{data-viz}*, you must have:

[%interactive]
* [ ] `all` {kib} privileges for the {ml-app} or Discover features in
  the appropriate spaces. Alternatively, `read` {kib} privileges for the 
  {ml-app} feature and `all` {kib} privileges for the {ipm-app} feature
* [ ] `manage_pipeline` or `manage_ingest_pipelines` cluster privileges
* [ ] `create`, `create_index`, `manage` and `read` index privileges for
  destination indices